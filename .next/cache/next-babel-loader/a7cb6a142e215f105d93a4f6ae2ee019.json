{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\hira sarkar\\\\Desktop\\\\New folder\\\\nextjs-ecommerce\\\\pages\\\\cart.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Head from 'next/head';\nimport { useContext, useState, useEffect } from 'react';\nimport { DataContext } from '../store/GlobalState';\nimport CartItem from '../components/CartItem';\nimport Link from 'next/link';\nimport { getData, postData } from '../utils/fetchData';\nimport { useRouter } from 'next/router';\n\nconst Cart = () => {\n  const {\n    state,\n    dispatch\n  } = useContext(DataContext);\n  const {\n    cart,\n    auth,\n    orders\n  } = state;\n  const {\n    0: total,\n    1: setTotal\n  } = useState(0);\n  const {\n    0: address,\n    1: setAddress\n  } = useState('');\n  const {\n    0: mobile,\n    1: setMobile\n  } = useState('');\n  const {\n    0: callback,\n    1: setCallback\n  } = useState(false);\n  const router = useRouter();\n  useEffect(() => {\n    const getTotal = () => {\n      const res = cart.reduce((prev, item) => {\n        return prev + item.price * item.quantity;\n      }, 0);\n      setTotal(res);\n    };\n\n    getTotal();\n  }, [cart]);\n  useEffect(() => {\n    const cartLocal = JSON.parse(localStorage.getItem('__next__cart01__devat'));\n\n    if (cartLocal && cartLocal.length > 0) {\n      let newArr = [];\n\n      const updateCart = async () => {\n        for (const item of cartLocal) {\n          const res = await getData(`product/${item._id}`);\n          const {\n            _id,\n            title,\n            images,\n            price,\n            inStock,\n            sold\n          } = res.product;\n\n          if (inStock > 0) {\n            newArr.push({\n              _id,\n              title,\n              images,\n              price,\n              inStock,\n              sold,\n              quantity: item.quantity > inStock ? 1 : item.quantity\n            });\n          }\n        }\n\n        dispatch({\n          type: 'ADD_CART',\n          payload: newArr\n        });\n      };\n\n      updateCart();\n    }\n  }, [callback]);\n\n  const handlePayment = async () => {\n    if (!address || !mobile) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'Please add your address and mobile.'\n      }\n    });\n    let newCart = [];\n\n    for (const item of cart) {\n      const res = await getData(`product/${item._id}`);\n\n      if (res.product.inStock - item.quantity >= 0) {\n        newCart.push(item);\n      }\n    }\n\n    if (newCart.length < cart.length) {\n      setCallback(!callback);\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: 'The product is out of stock or the quantity is insufficient.'\n        }\n      });\n    }\n\n    dispatch({\n      type: 'NOTIFY',\n      payload: {\n        loading: true\n      }\n    });\n    postData('order', {\n      address,\n      mobile,\n      cart,\n      total\n    }, auth.token).then(res => {\n      if (res.err) return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: res.err\n        }\n      });\n      dispatch({\n        type: 'ADD_CART',\n        payload: []\n      });\n\n      const newOrder = _objectSpread(_objectSpread({}, res.newOrder), {}, {\n        user: auth.user\n      });\n\n      dispatch({\n        type: 'ADD_ORDERS',\n        payload: [...orders, newOrder]\n      });\n      dispatch({\n        type: 'NOTIFY',\n        payload: {\n          success: res.msg\n        }\n      });\n      return router.push(`/order/${res.newOrder._id}`);\n    });\n  };\n\n  if (cart.length === 0) return /*#__PURE__*/_jsxDEV(\"img\", {\n    className: \"img-responsive w-100\",\n    src: \"/empty_cart.jpg\",\n    alt: \"not empty\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 12\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"Cart Page\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-8 text-secondary table-responsive my-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-uppercase\",\n        children: \"Shopping Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"table my-3\",\n        children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: cart.map(item => /*#__PURE__*/_jsxDEV(CartItem, {\n            item: item,\n            dispatch: dispatch,\n            cart: cart\n          }, item._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-4 my-3 text-right text-uppercase text-secondary\",\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Shipping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"address\",\n          children: \"Address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"address\",\n          id: \"address\",\n          className: \"form-control mb-2\",\n          value: address,\n          onChange: e => setAddress(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"mobile\",\n          children: \"Mobile\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"mobile\",\n          id: \"mobile\",\n          className: \"form-control mb-2\",\n          value: mobile,\n          onChange: e => setMobile(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [\"Total: \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-danger\",\n          children: [\"\\u20B9\", total]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 20\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        href: auth.user ? '#!' : '/signin',\n        children: /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"btn btn-dark my-2\",\n          onClick: handlePayment,\n          children: \"Proceed with payment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n};\n\nexport default Cart;","map":{"version":3,"sources":["C:/Users/hira sarkar/Desktop/New folder/nextjs-ecommerce/pages/cart.js"],"names":["Head","useContext","useState","useEffect","DataContext","CartItem","Link","getData","postData","useRouter","Cart","state","dispatch","cart","auth","orders","total","setTotal","address","setAddress","mobile","setMobile","callback","setCallback","router","getTotal","res","reduce","prev","item","price","quantity","cartLocal","JSON","parse","localStorage","getItem","length","newArr","updateCart","_id","title","images","inStock","sold","product","push","type","payload","handlePayment","error","newCart","loading","token","then","err","newOrder","user","success","msg","map","e","target","value"],"mappings":"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","sourcesContent":["import Head from 'next/head'\r\nimport { useContext, useState, useEffect } from 'react'\r\nimport { DataContext } from '../store/GlobalState'\r\nimport CartItem from '../components/CartItem'\r\nimport Link from 'next/link'\r\nimport { getData, postData } from '../utils/fetchData'\r\nimport { useRouter } from 'next/router'\r\n\r\n\r\nconst Cart = () => {\r\n  const { state, dispatch } = useContext(DataContext)\r\n  const { cart, auth, orders } = state\r\n\r\n  const [total, setTotal] = useState(0)\r\n\r\n  const [address, setAddress] = useState('')\r\n  const [mobile, setMobile] = useState('')\r\n\r\n  const [callback, setCallback] = useState(false)\r\n  const router = useRouter()\r\n\r\n  useEffect(() => {\r\n    const getTotal = () => {\r\n      const res = cart.reduce((prev, item) => {\r\n        return prev + (item.price * item.quantity)\r\n      }, 0)\r\n\r\n      setTotal(res)\r\n    }\r\n\r\n    getTotal()\r\n  }, [cart])\r\n\r\n  useEffect(() => {\r\n    const cartLocal = JSON.parse(localStorage.getItem('__next__cart01__devat'))\r\n    if (cartLocal && cartLocal.length > 0) {\r\n      let newArr = []\r\n      const updateCart = async () => {\r\n        for (const item of cartLocal) {\r\n          const res = await getData(`product/${item._id}`)\r\n          const { _id, title, images, price, inStock, sold } = res.product\r\n          if (inStock > 0) {\r\n            newArr.push({\r\n              _id, title, images, price, inStock, sold,\r\n              quantity: item.quantity > inStock ? 1 : item.quantity\r\n            })\r\n          }\r\n        }\r\n\r\n        dispatch({ type: 'ADD_CART', payload: newArr })\r\n      }\r\n\r\n      updateCart()\r\n    }\r\n  }, [callback])\r\n\r\n  const handlePayment = async () => {\r\n    if (!address || !mobile)\r\n      return dispatch({ type: 'NOTIFY', payload: { error: 'Please add your address and mobile.' } })\r\n\r\n    let newCart = [];\r\n    for (const item of cart) {\r\n      const res = await getData(`product/${item._id}`)\r\n      if (res.product.inStock - item.quantity >= 0) {\r\n        newCart.push(item)\r\n      }\r\n    }\r\n\r\n    if (newCart.length < cart.length) {\r\n      setCallback(!callback)\r\n      return dispatch({\r\n        type: 'NOTIFY', payload: {\r\n          error: 'The product is out of stock or the quantity is insufficient.'\r\n        }\r\n      })\r\n    }\r\n\r\n    dispatch({ type: 'NOTIFY', payload: { loading: true }, })\r\n\r\n    postData('order', { address, mobile, cart, total }, auth.token)\r\n      .then(res => {\r\n        if (res.err) return dispatch({ type: 'NOTIFY', payload: { error: res.err } })\r\n\r\n        dispatch({ type: 'ADD_CART', payload: [] })\r\n\r\n        const newOrder = {\r\n          ...res.newOrder,\r\n          user: auth.user\r\n        }\r\n        dispatch({ type: 'ADD_ORDERS', payload: [...orders, newOrder,] })\r\n        dispatch({ type: 'NOTIFY', payload: { success: res.msg } })\r\n        return router.push(`/order/${res.newOrder._id}`)\r\n      })\r\n\r\n  }\r\n\r\n  if (cart.length === 0)\r\n    return <img className=\"img-responsive w-100\" src=\"/empty_cart.jpg\" alt=\"not empty\" />\r\n\r\n  return (\r\n    <div className=\"row mx-auto\">\r\n      <Head>\r\n        <title>Cart Page</title>\r\n      </Head>\r\n\r\n      <div className=\"col-md-8 text-secondary table-responsive my-3\">\r\n        <h2 className=\"text-uppercase\">Shopping Cart</h2>\r\n\r\n        <table className=\"table my-3\">\r\n          <tbody>\r\n            {\r\n              cart.map(item => (\r\n                <CartItem key={item._id} item={item} dispatch={dispatch} cart={cart} />\r\n              ))\r\n            }\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <div className=\"col-md-4 my-3 text-right text-uppercase text-secondary\">\r\n        <form>\r\n          <h2>Shipping</h2>\r\n\r\n          <label htmlFor=\"address\">Address</label>\r\n          <input type=\"text\" name=\"address\" id=\"address\"\r\n            className=\"form-control mb-2\" value={address}\r\n            onChange={e => setAddress(e.target.value)} />\r\n\r\n          <label htmlFor=\"mobile\">Mobile</label>\r\n          <input type=\"text\" name=\"mobile\" id=\"mobile\"\r\n            className=\"form-control mb-2\" value={mobile}\r\n            onChange={e => setMobile(e.target.value)} />\r\n        </form>\r\n\r\n        <h3>Total: <span className=\"text-danger\">â‚¹{total}</span></h3>\r\n\r\n\r\n        <Link href={auth.user ? '#!' : '/signin'}>\r\n          <a className=\"btn btn-dark my-2\" onClick={handlePayment}>Proceed with payment</a>\r\n        </Link>\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Cart"]},"metadata":{},"sourceType":"module"}