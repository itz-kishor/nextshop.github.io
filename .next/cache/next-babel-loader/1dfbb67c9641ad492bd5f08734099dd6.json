{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Head from 'next/head';\nimport { useState, useContext, useEffect } from 'react';\nimport { DataContext } from '../store/GlobalState';\nimport Link from 'next/link';\nimport valid from '../utils/valid';\nimport { patchData } from '../utils/fetchData';\nimport { imageUpload } from '../utils/imageUpload';\n\nvar Profile = function Profile() {\n  var initialSate = {\n    avatar: '',\n    name: '',\n    password: '',\n    cf_password: ''\n  };\n\n  var _useState = useState(initialSate),\n      data = _useState[0],\n      setData = _useState[1];\n\n  var avatar = data.avatar,\n      name = data.name,\n      password = data.password,\n      cf_password = data.cf_password;\n\n  var _useContext = useContext(DataContext),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch;\n\n  var auth = state.auth,\n      notify = state.notify,\n      orders = state.orders;\n  useEffect(function () {\n    if (auth.user) setData(_objectSpread(_objectSpread({}, data), {}, {\n      name: auth.user.name\n    }));\n  }, [auth.user]);\n\n  var handleChange = function handleChange(e) {\n    var _e$target = e.target,\n        name = _e$target.name,\n        value = _e$target.value;\n    setData(_objectSpread(_objectSpread({}, data), {}, _defineProperty({}, name, value)));\n    dispatch({\n      type: 'NOTIFY',\n      payload: {}\n    });\n  };\n\n  var handleUpdateProfile = function handleUpdateProfile(e) {\n    e.preventDefault();\n\n    if (password) {\n      var errMsg = valid(name, auth.user.email, password, cf_password);\n      if (errMsg) return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: errMsg\n        }\n      });\n      updatePassword();\n    }\n\n    if (name !== auth.user.name || avatar) updateInfor();\n  };\n\n  var updatePassword = function updatePassword() {\n    dispatch({\n      type: 'NOTIFY',\n      payload: {\n        loading: true\n      }\n    });\n    patchData('user/resetPassword', {\n      password: password\n    }, auth.token).then(function (res) {\n      if (res.err) return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: res.err\n        }\n      });\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          success: res.msg\n        }\n      });\n    });\n  };\n\n  var changeAvatar = function changeAvatar(e) {\n    var file = e.target.files[0];\n    if (!file) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'File does not exist.'\n      }\n    });\n    if (file.size > 1024 * 1024) //1mb\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: 'The largest image size is 1mb.'\n        }\n      });\n    if (file.type !== \"image/jpeg\" && file.type !== \"image/png\") //1mb\n      return dispatch({\n        type: 'NOTIFY',\n        payload: {\n          error: 'Image format is incorrect.'\n        }\n      });\n    setData(_objectSpread(_objectSpread({}, data), {}, {\n      avatar: file\n    }));\n  };\n\n  var updateInfor = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var media;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  loading: true\n                }\n              });\n\n              if (!avatar) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 4;\n              return imageUpload([avatar]);\n\n            case 4:\n              media = _context.sent;\n\n            case 5:\n              patchData('user', {\n                name: name,\n                avatar: avatar ? media[0].url : auth.user.avatar\n              }, auth.token).then(function (res) {\n                if (res.err) return dispatch({\n                  type: 'NOTIFY',\n                  payload: {\n                    error: res.err\n                  }\n                });\n                dispatch({\n                  type: 'AUTH',\n                  payload: {\n                    token: auth.token,\n                    user: res.user\n                  }\n                });\n                return dispatch({\n                  type: 'NOTIFY',\n                  payload: {\n                    success: res.msg\n                  }\n                });\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function updateInfor() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  if (!auth.user) return null;\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"profile_page\",\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: \"Profile\"\n      })\n    }), /*#__PURE__*/_jsxs(\"section\", {\n      className: \"row text-secondary my-3\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-md-4\",\n        children: [/*#__PURE__*/_jsx(\"h3\", {\n          className: \"text-center text-uppercase\",\n          children: auth.user.role === 'user' ? 'User Profile' : 'Admin Profile'\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"avatar\",\n          children: [/*#__PURE__*/_jsx(\"img\", {\n            src: avatar ? URL.createObjectURL(avatar) : auth.user.avatar,\n            alt: \"avatar\"\n          }), /*#__PURE__*/_jsxs(\"span\", {\n            children: [/*#__PURE__*/_jsx(\"i\", {\n              className: \"fas fa-camera\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              children: \"Change\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              type: \"file\",\n              name: \"file\",\n              id: \"file_up\",\n              accept: \"image/*\",\n              onChange: changeAvatar\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"name\",\n            children: \"Name\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"text\",\n            name: \"name\",\n            value: name,\n            className: \"form-control\",\n            placeholder: \"Your name\",\n            onChange: handleChange\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"email\",\n            children: \"Email\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"text\",\n            name: \"email\",\n            defaultValue: auth.user.email,\n            className: \"form-control\",\n            disabled: true\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"password\",\n            children: \"New Password\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"password\",\n            name: \"password\",\n            value: password,\n            className: \"form-control\",\n            placeholder: \"Your new password\",\n            onChange: handleChange\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsx(\"label\", {\n            htmlFor: \"cf_password\",\n            children: \"Confirm New Password\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            type: \"password\",\n            name: \"cf_password\",\n            value: cf_password,\n            className: \"form-control\",\n            placeholder: \"Confirm new password\",\n            onChange: handleChange\n          })]\n        }), /*#__PURE__*/_jsx(\"button\", {\n          className: \"btn btn-info\",\n          disabled: notify.loading,\n          onClick: handleUpdateProfile,\n          children: \"Update\"\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {}), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-md-8\",\n        children: [/*#__PURE__*/_jsx(\"h3\", {\n          className: \"text-uppercase\",\n          children: \"Orders\"\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"my-3 table-responsive\",\n          children: /*#__PURE__*/_jsxs(\"table\", {\n            className: \"table-bordered table-hover w-100 text-uppercase\",\n            style: {\n              minWidth: '600px',\n              cursor: 'pointer'\n            },\n            children: [/*#__PURE__*/_jsx(\"thead\", {\n              className: \"bg-light font-weight-bold\",\n              children: /*#__PURE__*/_jsxs(\"tr\", {\n                children: [/*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"id\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"date\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"total\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"delivered\"\n                }), /*#__PURE__*/_jsx(\"td\", {\n                  className: \"p-2\",\n                  children: \"paid\"\n                })]\n              })\n            }), /*#__PURE__*/_jsx(\"tbody\", {\n              children: orders.map(function (order) {\n                return /*#__PURE__*/_jsxs(\"tr\", {\n                  children: [/*#__PURE__*/_jsx(\"td\", {\n                    className: \"p-2\",\n                    children: /*#__PURE__*/_jsx(Link, {\n                      href: \"/order/\".concat(order._id),\n                      children: /*#__PURE__*/_jsx(\"a\", {\n                        children: order._id\n                      })\n                    })\n                  }), /*#__PURE__*/_jsx(\"td\", {\n                    className: \"p-2\",\n                    children: new Date(order.createdAt).toLocaleDateString()\n                  }), /*#__PURE__*/_jsxs(\"td\", {\n                    className: \"p-2\",\n                    children: [\"\\u20B9\", order.total]\n                  }), /*#__PURE__*/_jsx(\"td\", {\n                    className: \"p-2\",\n                    children: order.delivered ? /*#__PURE__*/_jsx(\"i\", {\n                      className: \"fas fa-check text-success\"\n                    }) : /*#__PURE__*/_jsx(\"i\", {\n                      className: \"fas fa-times text-danger\"\n                    })\n                  }), /*#__PURE__*/_jsx(\"td\", {\n                    className: \"p-2\",\n                    children: order.paid ? /*#__PURE__*/_jsx(\"i\", {\n                      className: \"fas fa-check text-success\"\n                    }) : /*#__PURE__*/_jsx(\"i\", {\n                      className: \"fas fa-times text-danger\"\n                    })\n                  })]\n                }, order._id);\n              })\n            })]\n          })\n        })]\n      })]\n    })]\n  });\n};\n\nexport default Profile;","map":null,"metadata":{},"sourceType":"module"}