{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"E:\\\\nextjs-ecommerce\\\\pages\\\\create\\\\[[...id]].js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Head from 'next/head';\nimport { useState, useContext, useEffect } from 'react';\nimport { DataContext } from '../../store/GlobalState';\nimport { imageUpload } from '../../utils/imageUpload';\nimport { postData, getData, putData } from '../../utils/fetchData';\nimport { useRouter } from 'next/router';\n\nvar ProductsManager = function ProductsManager() {\n  _s();\n\n  var initialState = {\n    title: '',\n    price: 0,\n    inStock: 0,\n    description: '',\n    content: '',\n    category: ''\n  };\n\n  var _useState = useState(initialState),\n      product = _useState[0],\n      setProduct = _useState[1];\n\n  var title = product.title,\n      price = product.price,\n      inStock = product.inStock,\n      description = product.description,\n      content = product.content,\n      category = product.category;\n\n  var _useState2 = useState([]),\n      images = _useState2[0],\n      setImages = _useState2[1];\n\n  var _useContext = useContext(DataContext),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch;\n\n  var categories = state.categories,\n      auth = state.auth;\n  var router = useRouter();\n  var id = router.query.id;\n\n  var _useState3 = useState(false),\n      onEdit = _useState3[0],\n      setOnEdit = _useState3[1];\n\n  useEffect(function () {\n    if (id) {\n      setOnEdit(true);\n      getData(\"product/\".concat(id)).then(function (res) {\n        setProduct(res.product);\n        setImages(res.product.images);\n      });\n    } else {\n      setOnEdit(false);\n      setProduct(initialState);\n      setImages([]);\n    }\n  }, [id]);\n\n  var handleChangeInput = function handleChangeInput(e) {\n    var _e$target = e.target,\n        name = _e$target.name,\n        value = _e$target.value;\n    setProduct(_objectSpread(_objectSpread({}, product), {}, _defineProperty({}, name, value)));\n    dispatch({\n      type: 'NOTIFY',\n      payload: {}\n    });\n  };\n\n  var handleUploadInput = function handleUploadInput(e) {\n    dispatch({\n      type: 'NOTIFY',\n      payload: {}\n    });\n    var newImages = [];\n    var num = 0;\n    var err = '';\n\n    var files = _toConsumableArray(e.target.files);\n\n    if (files.length === 0) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'Files does not exist.'\n      }\n    });\n    files.forEach(function (file) {\n      if (file.size > 1024 * 1024) return err = 'The largest image size is 1mb';\n      if (file.type !== 'image/jpeg' && file.type !== 'image/png') return err = 'Image format is incorrect.';\n      num += 1;\n      if (num <= 5) newImages.push(file);\n      return newImages;\n    });\n    if (err) dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: err\n      }\n    });\n    var imgCount = images.length;\n    if (imgCount + newImages.length > 5) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'Select up to 5 images.'\n      }\n    });\n    setImages([].concat(_toConsumableArray(images), newImages));\n  };\n\n  var deleteImage = function deleteImage(index) {\n    var newArr = _toConsumableArray(images);\n\n    newArr.splice(index, 1);\n    setImages(newArr);\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var media, imgNewURL, imgOldURL, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!(auth.user.role !== 'admin')) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: 'Authentication is not valid.'\n                }\n              }));\n\n            case 3:\n              if (!(!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0)) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: 'Please add all the fields.'\n                }\n              }));\n\n            case 5:\n              dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  loading: true\n                }\n              });\n              media = [];\n              imgNewURL = images.filter(function (img) {\n                return !img.url;\n              });\n              imgOldURL = images.filter(function (img) {\n                return img.url;\n              });\n\n              if (!(imgNewURL.length > 0)) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 12;\n              return imageUpload(imgNewURL);\n\n            case 12:\n              media = _context.sent;\n\n            case 13:\n              if (!onEdit) {\n                _context.next = 21;\n                break;\n              }\n\n              _context.next = 16;\n              return putData(\"product/\".concat(id), _objectSpread(_objectSpread({}, product), {}, {\n                images: [].concat(_toConsumableArray(imgOldURL), _toConsumableArray(media))\n              }), auth.token);\n\n            case 16:\n              res = _context.sent;\n\n              if (!res.err) {\n                _context.next = 19;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: res.err\n                }\n              }));\n\n            case 19:\n              _context.next = 26;\n              break;\n\n            case 21:\n              _context.next = 23;\n              return postData('product', _objectSpread(_objectSpread({}, product), {}, {\n                images: [].concat(_toConsumableArray(imgOldURL), _toConsumableArray(media))\n              }), auth.token);\n\n            case 23:\n              res = _context.sent;\n\n              if (!res.err) {\n                _context.next = 26;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: res.err\n                }\n              }));\n\n            case 26:\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  success: res.msg\n                }\n              }));\n\n            case 27:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"products_manager\",\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"Products Manager\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, _this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"row\",\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"title\",\n          value: title,\n          placeholder: \"Title\",\n          className: \"d-block my-4 w-100 p-2\",\n          onChange: handleChangeInput\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-sm-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"price\",\n              children: \"Price\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 29\n            }, _this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              name: \"price\",\n              value: price,\n              placeholder: \"Price\",\n              className: \"d-block w-100 p-2\",\n              onChange: handleChangeInput\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 29\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 25\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-sm-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"price\",\n              children: \"In Stock\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 29\n            }, _this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              name: \"inStock\",\n              value: inStock,\n              placeholder: \"inStock\",\n              className: \"d-block w-100 p-2\",\n              onChange: handleChangeInput\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 136,\n              columnNumber: 29\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 25\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          name: \"description\",\n          id: \"description\",\n          cols: \"30\",\n          rows: \"4\",\n          placeholder: \"Description\",\n          onChange: handleChangeInput,\n          className: \"d-block my-4 w-100 p-2\",\n          value: description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          name: \"content\",\n          id: \"content\",\n          cols: \"30\",\n          rows: \"6\",\n          placeholder: \"Content\",\n          onChange: handleChangeInput,\n          className: \"d-block my-4 w-100 p-2\",\n          value: content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"input-group-prepend px-0 my-2\",\n          children: /*#__PURE__*/_jsxDEV(\"select\", {\n            name: \"category\",\n            id: \"category\",\n            value: category,\n            onChange: handleChangeInput,\n            className: \"custom-select text-capitalize\",\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"all\",\n              children: \"All Products\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 29\n            }, _this), categories.map(function (item) {\n              return /*#__PURE__*/_jsxDEV(\"option\", {\n                value: item._id,\n                children: item.name\n              }, item._id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 156,\n                columnNumber: 37\n              }, _this);\n            })]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 25\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"btn btn-info my-2 px-4\",\n          children: onEdit ? 'Update' : 'Create'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 21\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-6 my-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"input-group mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"input-group-prepend\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"input-group-text\",\n              children: \"Upload\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 29\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 25\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"custom-file border rounded\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"file\",\n              className: \"custom-file-input\",\n              onChange: handleUploadInput,\n              multiple: true,\n              accept: \"image/*\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 29\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 25\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row img-up mx-0\",\n          children: images.map(function (img, index) {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"file_img my-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: img.url ? img.url : URL.createObjectURL(img),\n                alt: \"\",\n                className: \"img-thumbnail rounded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 37\n              }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n                onClick: function onClick() {\n                  return deleteImage(index);\n                },\n                children: \"X\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 189,\n                columnNumber: 38\n              }, _this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 33\n            }, _this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 21\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 9\n  }, _this);\n};\n\n_s(ProductsManager, \"+PGq5nzL/dTHZhYuSuUx+elkF0s=\", false, function () {\n  return [useRouter];\n});\n\n_c = ProductsManager;\nexport default ProductsManager;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProductsManager\");","map":{"version":3,"sources":["E:/nextjs-ecommerce/pages/create/[[...id]].js"],"names":["Head","useState","useContext","useEffect","DataContext","imageUpload","postData","getData","putData","useRouter","ProductsManager","initialState","title","price","inStock","description","content","category","product","setProduct","images","setImages","state","dispatch","categories","auth","router","id","query","onEdit","setOnEdit","then","res","handleChangeInput","e","target","name","value","type","payload","handleUploadInput","newImages","num","err","files","length","error","forEach","file","size","push","imgCount","deleteImage","index","newArr","splice","handleSubmit","preventDefault","user","role","loading","media","imgNewURL","filter","img","url","imgOldURL","token","success","msg","map","item","_id","URL","createObjectURL"],"mappings":"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","sourcesContent":["import Head from 'next/head'\r\nimport {useState, useContext, useEffect} from 'react'\r\nimport {DataContext} from '../../store/GlobalState'\r\nimport {imageUpload} from '../../utils/imageUpload'\r\nimport {postData, getData, putData} from '../../utils/fetchData'\r\nimport {useRouter} from 'next/router'\r\n\r\nconst ProductsManager = () => {\r\n    const initialState = {\r\n        title: '',\r\n        price: 0,\r\n        inStock: 0,\r\n        description: '',\r\n        content: '',\r\n        category: ''\r\n    }\r\n    const [product, setProduct] = useState(initialState)\r\n    const {title, price, inStock, description, content, category} = product\r\n\r\n    const [images, setImages] = useState([])\r\n\r\n    const {state, dispatch} = useContext(DataContext)\r\n    const {categories, auth} = state\r\n\r\n    const router = useRouter()\r\n    const {id} = router.query\r\n    const [onEdit, setOnEdit] = useState(false)\r\n\r\n    useEffect(() => {\r\n        if(id){\r\n            setOnEdit(true)\r\n            getData(`product/${id}`).then(res => {\r\n                setProduct(res.product)\r\n                setImages(res.product.images)\r\n            })\r\n        }else{\r\n            setOnEdit(false)\r\n            setProduct(initialState)\r\n            setImages([])\r\n        }\r\n    },[id])\r\n\r\n    const handleChangeInput = e => {\r\n        const {name, value} = e.target\r\n        setProduct({...product, [name]:value})\r\n        dispatch({type: 'NOTIFY', payload: {}})\r\n    }\r\n\r\n    const handleUploadInput = e => {\r\n        dispatch({type: 'NOTIFY', payload: {}})\r\n        let newImages = []\r\n        let num = 0\r\n        let err = ''\r\n        const files = [...e.target.files]\r\n\r\n        if(files.length === 0) \r\n        return dispatch({type: 'NOTIFY', payload: {error: 'Files does not exist.'}})\r\n\r\n        files.forEach(file => {\r\n            if(file.size > 1024 * 1024)\r\n            return err = 'The largest image size is 1mb'\r\n\r\n            if(file.type !== 'image/jpeg' && file.type !== 'image/png')\r\n            return err = 'Image format is incorrect.'\r\n\r\n            num += 1;\r\n            if(num <= 5) newImages.push(file)\r\n            return newImages;\r\n        })\r\n\r\n        if(err) dispatch({type: 'NOTIFY', payload: {error: err}})\r\n\r\n        const imgCount = images.length\r\n        if(imgCount + newImages.length > 5)\r\n        return dispatch({type: 'NOTIFY', payload: {error: 'Select up to 5 images.'}})\r\n        setImages([...images, ...newImages])\r\n    }\r\n\r\n    const deleteImage = index => {\r\n        const newArr = [...images]\r\n        newArr.splice(index, 1)\r\n        setImages(newArr)\r\n    }\r\n\r\n    const handleSubmit = async(e) => {\r\n        e.preventDefault()\r\n        if(auth.user.role !== 'admin') \r\n        return dispatch({type: 'NOTIFY', payload: {error: 'Authentication is not valid.'}})\r\n\r\n        if(!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0)\r\n        return dispatch({type: 'NOTIFY', payload: {error: 'Please add all the fields.'}})\r\n\r\n    \r\n        dispatch({type: 'NOTIFY', payload: {loading: true}})\r\n        let media = []\r\n        const imgNewURL = images.filter(img => !img.url)\r\n        const imgOldURL = images.filter(img => img.url)\r\n\r\n        if(imgNewURL.length > 0) media = await imageUpload(imgNewURL)\r\n\r\n        let res;\r\n        if(onEdit){\r\n            res = await putData(`product/${id}`, {...product, images: [...imgOldURL, ...media]}, auth.token)\r\n            if(res.err) return dispatch({type: 'NOTIFY', payload: {error: res.err}})\r\n        }else{\r\n            res = await postData('product', {...product, images: [...imgOldURL, ...media]}, auth.token)\r\n            if(res.err) return dispatch({type: 'NOTIFY', payload: {error: res.err}})\r\n        }\r\n\r\n        return dispatch({type: 'NOTIFY', payload: {success: res.msg}})\r\n        \r\n    }\r\n\r\n    return(\r\n        <div className=\"products_manager\">\r\n            <Head>\r\n                <title>Products Manager</title>\r\n            </Head>\r\n            <form className=\"row\" onSubmit={handleSubmit}>\r\n                <div className=\"col-md-6\">\r\n                    \r\n                    <input type=\"text\" name=\"title\" value={title}\r\n                    placeholder=\"Title\" className=\"d-block my-4 w-100 p-2\"\r\n                    onChange={handleChangeInput} />\r\n\r\n                    <div className=\"row\">\r\n                        <div className=\"col-sm-6\">\r\n                            <label htmlFor=\"price\">Price</label>\r\n                            <input type=\"number\" name=\"price\" value={price}\r\n                            placeholder=\"Price\" className=\"d-block w-100 p-2\"\r\n                            onChange={handleChangeInput} />\r\n                        </div>\r\n\r\n                        <div className=\"col-sm-6\">\r\n                            <label htmlFor=\"price\">In Stock</label>\r\n                            <input type=\"number\" name=\"inStock\" value={inStock}\r\n                            placeholder=\"inStock\" className=\"d-block w-100 p-2\"\r\n                            onChange={handleChangeInput} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <textarea name=\"description\" id=\"description\" cols=\"30\" rows=\"4\"\r\n                    placeholder=\"Description\" onChange={handleChangeInput}\r\n                    className=\"d-block my-4 w-100 p-2\" value={description} />\r\n\r\n                    <textarea name=\"content\" id=\"content\" cols=\"30\" rows=\"6\"\r\n                    placeholder=\"Content\" onChange={handleChangeInput}\r\n                    className=\"d-block my-4 w-100 p-2\" value={content} />\r\n\r\n                    <div className=\"input-group-prepend px-0 my-2\">\r\n                        <select name=\"category\" id=\"category\" value={category}\r\n                        onChange={handleChangeInput} className=\"custom-select text-capitalize\">\r\n                            <option value=\"all\">All Products</option>\r\n                            {\r\n                                categories.map(item => (\r\n                                    <option key={item._id} value={item._id}>\r\n                                        {item.name}\r\n                                    </option>\r\n                                ))\r\n                            }\r\n                        </select>\r\n                    </div>\r\n\r\n                    <button type=\"submit\" className=\"btn btn-info my-2 px-4\">\r\n                        {onEdit ? 'Update': 'Create'}\r\n                    </button>\r\n\r\n                </div>\r\n\r\n                <div className=\"col-md-6 my-4\">\r\n                    <div className=\"input-group mb-3\">\r\n                        <div className=\"input-group-prepend\">\r\n                            <span className=\"input-group-text\">Upload</span>\r\n                        </div>\r\n                        <div className=\"custom-file border rounded\">\r\n                            <input type=\"file\" className=\"custom-file-input\"\r\n                            onChange={handleUploadInput} multiple accept=\"image/*\" />\r\n                        </div>\r\n\r\n                    </div> \r\n\r\n                    <div className=\"row img-up mx-0\">\r\n                        {\r\n                            images.map((img, index) => (\r\n                                <div key={index} className=\"file_img my-1\">\r\n                                    <img src={img.url ? img.url : URL.createObjectURL(img)}\r\n                                     alt=\"\" className=\"img-thumbnail rounded\" />\r\n\r\n                                     <span onClick={() => deleteImage(index)}>X</span>\r\n                                </div>\r\n                            ))\r\n                        }\r\n                    </div>\r\n                        \r\n\r\n                </div>\r\n\r\n               \r\n            </form>\r\n\r\n            \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ProductsManager"]},"metadata":{},"sourceType":"module"}