{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\hira sarkar\\\\Desktop\\\\New folder\\\\nextjs-ecommerce\\\\pages\\\\cart.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport Head from 'next/head';\nimport { useContext, useState, useEffect } from 'react';\nimport { DataContext } from '../store/GlobalState';\nimport CartItem from '../components/CartItem';\nimport Link from 'next/link';\nimport { getData, postData } from '../utils/fetchData';\nimport { useRouter } from 'next/router';\n\nvar Cart = function Cart() {\n  _s();\n\n  var _useContext = useContext(DataContext),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch;\n\n  var cart = state.cart,\n      auth = state.auth,\n      orders = state.orders;\n\n  var _useState = useState(0),\n      total = _useState[0],\n      setTotal = _useState[1];\n\n  var _useState2 = useState(''),\n      address = _useState2[0],\n      setAddress = _useState2[1];\n\n  var _useState3 = useState(''),\n      mobile = _useState3[0],\n      setMobile = _useState3[1];\n\n  var _useState4 = useState(false),\n      callback = _useState4[0],\n      setCallback = _useState4[1];\n\n  var router = useRouter();\n  useEffect(function () {\n    var getTotal = function getTotal() {\n      var res = cart.reduce(function (prev, item) {\n        return prev + item.price * item.quantity;\n      }, 0);\n      setTotal(res);\n    };\n\n    getTotal();\n  }, [cart]);\n  useEffect(function () {\n    var cartLocal = JSON.parse(localStorage.getItem('__next__cart01__devat'));\n\n    if (cartLocal && cartLocal.length > 0) {\n      var newArr = [];\n\n      var updateCart = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var _iterator, _step, item, res, _res$product, _id, title, images, price, inStock, sold;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _iterator = _createForOfIteratorHelper(cartLocal);\n                  _context.prev = 1;\n\n                  _iterator.s();\n\n                case 3:\n                  if ((_step = _iterator.n()).done) {\n                    _context.next = 12;\n                    break;\n                  }\n\n                  item = _step.value;\n                  _context.next = 7;\n                  return getData(\"product/\".concat(item._id));\n\n                case 7:\n                  res = _context.sent;\n                  _res$product = res.product, _id = _res$product._id, title = _res$product.title, images = _res$product.images, price = _res$product.price, inStock = _res$product.inStock, sold = _res$product.sold;\n\n                  if (inStock > 0) {\n                    newArr.push({\n                      _id: _id,\n                      title: title,\n                      images: images,\n                      price: price,\n                      inStock: inStock,\n                      sold: sold,\n                      quantity: item.quantity > inStock ? 1 : item.quantity\n                    });\n                  }\n\n                case 10:\n                  _context.next = 3;\n                  break;\n\n                case 12:\n                  _context.next = 17;\n                  break;\n\n                case 14:\n                  _context.prev = 14;\n                  _context.t0 = _context[\"catch\"](1);\n\n                  _iterator.e(_context.t0);\n\n                case 17:\n                  _context.prev = 17;\n\n                  _iterator.f();\n\n                  return _context.finish(17);\n\n                case 20:\n                  dispatch({\n                    type: 'ADD_CART',\n                    payload: newArr\n                  });\n\n                case 21:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[1, 14, 17, 20]]);\n        }));\n\n        return function updateCart() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      updateCart();\n    }\n  }, [callback]);\n\n  var handlePayment = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var newCart, _iterator2, _step2, item, res;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(!address || !mobile)) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: 'Please add your address and mobile.'\n                }\n              }));\n\n            case 2:\n              newCart = [];\n              _iterator2 = _createForOfIteratorHelper(cart);\n              _context2.prev = 4;\n\n              _iterator2.s();\n\n            case 6:\n              if ((_step2 = _iterator2.n()).done) {\n                _context2.next = 14;\n                break;\n              }\n\n              item = _step2.value;\n              _context2.next = 10;\n              return getData(\"product/\".concat(item._id));\n\n            case 10:\n              res = _context2.sent;\n\n              if (res.product.inStock - item.quantity >= 0) {\n                newCart.push(item);\n              }\n\n            case 12:\n              _context2.next = 6;\n              break;\n\n            case 14:\n              _context2.next = 19;\n              break;\n\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](4);\n\n              _iterator2.e(_context2.t0);\n\n            case 19:\n              _context2.prev = 19;\n\n              _iterator2.f();\n\n              return _context2.finish(19);\n\n            case 22:\n              if (!(newCart.length < cart.length)) {\n                _context2.next = 25;\n                break;\n              }\n\n              setCallback(!callback);\n              return _context2.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: 'The product is out of stock or the quantity is insufficient.'\n                }\n              }));\n\n            case 25:\n              dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  loading: true\n                }\n              });\n              postData('order', {\n                address: address,\n                mobile: mobile,\n                cart: cart,\n                total: total\n              }, auth.token).then(function (res) {\n                if (res.err) return dispatch({\n                  type: 'NOTIFY',\n                  payload: {\n                    error: res.err\n                  }\n                });\n                dispatch({\n                  type: 'ADD_CART',\n                  payload: []\n                });\n\n                var newOrder = _objectSpread(_objectSpread({}, res.newOrder), {}, {\n                  user: auth.user\n                });\n\n                dispatch({\n                  type: 'ADD_ORDERS',\n                  payload: [].concat(_toConsumableArray(orders), [newOrder, {\n                    success: res.msg\n                  }])\n                });\n                dispatch({\n                  type: 'NOTIFY',\n                  payload: {\n                    success: res.msg\n                  }\n                });\n                return router.push(\"/order/\".concat(res.newOrder._id));\n              });\n\n            case 27:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[4, 16, 19, 22]]);\n    }));\n\n    return function handlePayment() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (cart.length === 0) return /*#__PURE__*/_jsxDEV(\"img\", {\n    className: \"img-responsive w-100\",\n    src: \"/empty_cart.jpg\",\n    alt: \"not empty\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 12\n  }, _this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"Cart Page\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-8 text-secondary table-responsive my-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-uppercase\",\n        children: \"Shopping Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"table my-3\",\n        children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: cart.map(function (item) {\n            return /*#__PURE__*/_jsxDEV(CartItem, {\n              item: item,\n              dispatch: dispatch,\n              cart: cart\n            }, item._id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 17\n            }, _this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-4 my-3 text-right text-uppercase text-secondary\",\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Shipping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"address\",\n          children: \"Address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"address\",\n          id: \"address\",\n          className: \"form-control mb-2\",\n          value: address,\n          onChange: function onChange(e) {\n            return setAddress(e.target.value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"mobile\",\n          children: \"Mobile\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"mobile\",\n          id: \"mobile\",\n          className: \"form-control mb-2\",\n          value: mobile,\n          onChange: function onChange(e) {\n            return setMobile(e.target.value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [\"Total: \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-danger\",\n          children: [\"\\u20B9\", total]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 20\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Link, {\n        href: auth.user ? '#!' : '/signin',\n        children: /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"btn btn-dark my-2\",\n          onClick: handlePayment,\n          children: \"Proceed with payment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(Cart, \"XIgSdvOytwT6qTZ+W0TKrtQ98GE=\", false, function () {\n  return [useRouter];\n});\n\n_c = Cart;\nexport default Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"sources":["C:/Users/hira sarkar/Desktop/New folder/nextjs-ecommerce/pages/cart.js"],"names":["Head","useContext","useState","useEffect","DataContext","CartItem","Link","getData","postData","useRouter","Cart","state","dispatch","cart","auth","orders","total","setTotal","address","setAddress","mobile","setMobile","callback","setCallback","router","getTotal","res","reduce","prev","item","price","quantity","cartLocal","JSON","parse","localStorage","getItem","length","newArr","updateCart","_id","product","title","images","inStock","sold","push","type","payload","handlePayment","error","newCart","loading","token","then","err","newOrder","user","success","msg","map","e","target","value"],"mappings":"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","sourcesContent":["import Head from 'next/head'\r\nimport { useContext, useState, useEffect } from 'react'\r\nimport { DataContext } from '../store/GlobalState'\r\nimport CartItem from '../components/CartItem'\r\nimport Link from 'next/link'\r\nimport { getData, postData } from '../utils/fetchData'\r\nimport { useRouter } from 'next/router'\r\n\r\n\r\nconst Cart = () => {\r\n  const { state, dispatch } = useContext(DataContext)\r\n  const { cart, auth, orders } = state\r\n\r\n  const [total, setTotal] = useState(0)\r\n\r\n  const [address, setAddress] = useState('')\r\n  const [mobile, setMobile] = useState('')\r\n\r\n  const [callback, setCallback] = useState(false)\r\n  const router = useRouter()\r\n\r\n  useEffect(() => {\r\n    const getTotal = () => {\r\n      const res = cart.reduce((prev, item) => {\r\n        return prev + (item.price * item.quantity)\r\n      }, 0)\r\n\r\n      setTotal(res)\r\n    }\r\n\r\n    getTotal()\r\n  }, [cart])\r\n\r\n  useEffect(() => {\r\n    const cartLocal = JSON.parse(localStorage.getItem('__next__cart01__devat'))\r\n    if (cartLocal && cartLocal.length > 0) {\r\n      let newArr = []\r\n      const updateCart = async () => {\r\n        for (const item of cartLocal) {\r\n          const res = await getData(`product/${item._id}`)\r\n          const { _id, title, images, price, inStock, sold } = res.product\r\n          if (inStock > 0) {\r\n            newArr.push({\r\n              _id, title, images, price, inStock, sold,\r\n              quantity: item.quantity > inStock ? 1 : item.quantity\r\n            })\r\n          }\r\n        }\r\n\r\n        dispatch({ type: 'ADD_CART', payload: newArr })\r\n      }\r\n\r\n      updateCart()\r\n    }\r\n  }, [callback])\r\n\r\n  const handlePayment = async () => {\r\n    if (!address || !mobile)\r\n      return dispatch({ type: 'NOTIFY', payload: { error: 'Please add your address and mobile.' } })\r\n\r\n    let newCart = [];\r\n    for (const item of cart) {\r\n      const res = await getData(`product/${item._id}`)\r\n      if (res.product.inStock - item.quantity >= 0) {\r\n        newCart.push(item)\r\n      }\r\n    }\r\n\r\n    if (newCart.length < cart.length) {\r\n      setCallback(!callback)\r\n      return dispatch({\r\n        type: 'NOTIFY', payload: {\r\n          error: 'The product is out of stock or the quantity is insufficient.'\r\n        }\r\n      })\r\n    }\r\n\r\n    dispatch({ type: 'NOTIFY', payload: { loading: true } })\r\n\r\n    postData('order', { address, mobile, cart, total }, auth.token)\r\n      .then(res => {\r\n        if (res.err) return dispatch({ type: 'NOTIFY', payload: { error: res.err } })\r\n\r\n        dispatch({ type: 'ADD_CART', payload: [] })\r\n\r\n        const newOrder = {\r\n          ...res.newOrder,\r\n          user: auth.user\r\n        }\r\n        dispatch({ type: 'ADD_ORDERS', payload: [...orders, newOrder, { success: res.msg }] })\r\n        dispatch({ type: 'NOTIFY', payload: { success: res.msg } })\r\n        return router.push(`/order/${res.newOrder._id}`)\r\n      })\r\n\r\n  }\r\n\r\n  if (cart.length === 0)\r\n    return <img className=\"img-responsive w-100\" src=\"/empty_cart.jpg\" alt=\"not empty\" />\r\n\r\n  return (\r\n    <div className=\"row mx-auto\">\r\n      <Head>\r\n        <title>Cart Page</title>\r\n      </Head>\r\n\r\n      <div className=\"col-md-8 text-secondary table-responsive my-3\">\r\n        <h2 className=\"text-uppercase\">Shopping Cart</h2>\r\n\r\n        <table className=\"table my-3\">\r\n          <tbody>\r\n            {\r\n              cart.map(item => (\r\n                <CartItem key={item._id} item={item} dispatch={dispatch} cart={cart} />\r\n              ))\r\n            }\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <div className=\"col-md-4 my-3 text-right text-uppercase text-secondary\">\r\n        <form>\r\n          <h2>Shipping</h2>\r\n\r\n          <label htmlFor=\"address\">Address</label>\r\n          <input type=\"text\" name=\"address\" id=\"address\"\r\n            className=\"form-control mb-2\" value={address}\r\n            onChange={e => setAddress(e.target.value)} />\r\n\r\n          <label htmlFor=\"mobile\">Mobile</label>\r\n          <input type=\"text\" name=\"mobile\" id=\"mobile\"\r\n            className=\"form-control mb-2\" value={mobile}\r\n            onChange={e => setMobile(e.target.value)} />\r\n        </form>\r\n\r\n        <h3>Total: <span className=\"text-danger\">â‚¹{total}</span></h3>\r\n\r\n\r\n        <Link href={auth.user ? '#!' : '/signin'}>\r\n          <a className=\"btn btn-dark my-2\" onClick={handlePayment}>Proceed with payment</a>\r\n        </Link>\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Cart"]},"metadata":{},"sourceType":"module"}