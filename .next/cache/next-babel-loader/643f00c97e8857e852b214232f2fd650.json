{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Head from 'next/head';\nimport { useState, useContext, useEffect } from 'react';\nimport { DataContext } from '../../store/GlobalState';\nimport { imageUpload } from '../../utils/imageUpload';\nimport { postData, getData, putData } from '../../utils/fetchData';\nimport { useRouter } from 'next/router';\n\nvar ProductsManager = function ProductsManager() {\n  var initialState = {\n    title: '',\n    price: 0,\n    inStock: 0,\n    description: '',\n    content: '',\n    category: ''\n  };\n\n  var _useState = useState(initialState),\n      product = _useState[0],\n      setProduct = _useState[1];\n\n  var title = product.title,\n      price = product.price,\n      inStock = product.inStock,\n      description = product.description,\n      content = product.content,\n      category = product.category;\n\n  var _useState2 = useState([]),\n      images = _useState2[0],\n      setImages = _useState2[1];\n\n  var _useContext = useContext(DataContext),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch;\n\n  var categories = state.categories,\n      auth = state.auth;\n  var router = useRouter();\n  var id = router.query.id;\n\n  var _useState3 = useState(false),\n      onEdit = _useState3[0],\n      setOnEdit = _useState3[1];\n\n  useEffect(function () {\n    if (id) {\n      setOnEdit(true);\n      getData(\"product/\".concat(id)).then(function (res) {\n        setProduct(res.product);\n        setImages(res.product.images);\n      });\n    } else {\n      setOnEdit(false);\n      setProduct(initialState);\n      setImages([]);\n    }\n  }, [id]);\n\n  var handleChangeInput = function handleChangeInput(e) {\n    var _e$target = e.target,\n        name = _e$target.name,\n        value = _e$target.value;\n    setProduct(_objectSpread(_objectSpread({}, product), {}, _defineProperty({}, name, value)));\n    dispatch({\n      type: 'NOTIFY',\n      payload: {}\n    });\n  };\n\n  var handleUploadInput = function handleUploadInput(e) {\n    dispatch({\n      type: 'NOTIFY',\n      payload: {}\n    });\n    var newImages = [];\n    var num = 0;\n    var err = '';\n\n    var files = _toConsumableArray(e.target.files);\n\n    if (files.length === 0) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'Files does not exist.'\n      }\n    });\n    files.forEach(function (file) {\n      if (file.size > 1024 * 1024) return err = 'The largest image size is 1mb';\n      if (file.type !== 'image/jpeg' && file.type !== 'image/png') return err = 'Image format is incorrect.';\n      num += 1;\n      if (num <= 5) newImages.push(file);\n      return newImages;\n    });\n    if (err) dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: err\n      }\n    });\n    var imgCount = images.length;\n    if (imgCount + newImages.length > 5) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'Select up to 5 images.'\n      }\n    });\n    setImages([].concat(_toConsumableArray(images), newImages));\n  };\n\n  var deleteImage = function deleteImage(index) {\n    var newArr = _toConsumableArray(images);\n\n    newArr.splice(index, 1);\n    setImages(newArr);\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var media, imgNewURL, imgOldURL, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!(auth.user.role !== 'admin')) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: 'Authentication is not valid.'\n                }\n              }));\n\n            case 3:\n              if (!(!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0)) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: 'Please add all the fields.'\n                }\n              }));\n\n            case 5:\n              dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  loading: true\n                }\n              });\n              media = [];\n              imgNewURL = images.filter(function (img) {\n                return !img.url;\n              });\n              imgOldURL = images.filter(function (img) {\n                return img.url;\n              });\n\n              if (!(imgNewURL.length > 0)) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 12;\n              return imageUpload(imgNewURL);\n\n            case 12:\n              media = _context.sent;\n\n            case 13:\n              if (!onEdit) {\n                _context.next = 21;\n                break;\n              }\n\n              _context.next = 16;\n              return putData(\"product/\".concat(id), _objectSpread(_objectSpread({}, product), {}, {\n                images: [].concat(_toConsumableArray(imgOldURL), _toConsumableArray(media))\n              }), auth.token);\n\n            case 16:\n              res = _context.sent;\n\n              if (!res.err) {\n                _context.next = 19;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: res.err\n                }\n              }));\n\n            case 19:\n              _context.next = 26;\n              break;\n\n            case 21:\n              _context.next = 23;\n              return postData('product', _objectSpread(_objectSpread({}, product), {}, {\n                images: [].concat(_toConsumableArray(imgOldURL), _toConsumableArray(media))\n              }), auth.token);\n\n            case 23:\n              res = _context.sent;\n\n              if (!res.err) {\n                _context.next = 26;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  error: res.err\n                }\n              }));\n\n            case 26:\n              return _context.abrupt(\"return\", dispatch({\n                type: 'NOTIFY',\n                payload: {\n                  success: res.msg\n                }\n              }));\n\n            case 27:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"products_manager\",\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: \"Products Manager\"\n      })\n    }), /*#__PURE__*/_jsxs(\"form\", {\n      className: \"row\",\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-md-6\",\n        children: [/*#__PURE__*/_jsx(\"input\", {\n          type: \"text\",\n          name: \"title\",\n          value: title,\n          placeholder: \"Title\",\n          className: \"d-block my-4 w-100 p-2\",\n          onChange: handleChangeInput\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-sm-6\",\n            children: [/*#__PURE__*/_jsx(\"label\", {\n              htmlFor: \"price\",\n              children: \"Price\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              type: \"number\",\n              name: \"price\",\n              value: price,\n              placeholder: \"Price\",\n              className: \"d-block w-100 p-2\",\n              onChange: handleChangeInput\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"col-sm-6\",\n            children: [/*#__PURE__*/_jsx(\"label\", {\n              htmlFor: \"price\",\n              children: \"In Stock\"\n            }), /*#__PURE__*/_jsx(\"input\", {\n              type: \"number\",\n              name: \"inStock\",\n              value: inStock,\n              placeholder: \"inStock\",\n              className: \"d-block w-100 p-2\",\n              onChange: handleChangeInput\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(\"textarea\", {\n          name: \"description\",\n          id: \"description\",\n          cols: \"30\",\n          rows: \"4\",\n          placeholder: \"Description\",\n          onChange: handleChangeInput,\n          className: \"d-block my-4 w-100 p-2\",\n          value: description\n        }), /*#__PURE__*/_jsx(\"textarea\", {\n          name: \"content\",\n          id: \"content\",\n          cols: \"30\",\n          rows: \"6\",\n          placeholder: \"Content\",\n          onChange: handleChangeInput,\n          className: \"d-block my-4 w-100 p-2\",\n          value: content\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"input-group-prepend px-0 my-2\",\n          children: /*#__PURE__*/_jsxs(\"select\", {\n            name: \"category\",\n            id: \"category\",\n            value: category,\n            onChange: handleChangeInput,\n            className: \"custom-select text-capitalize\",\n            children: [/*#__PURE__*/_jsx(\"option\", {\n              value: \"all\",\n              children: \"All Products\"\n            }), categories.map(function (item) {\n              return /*#__PURE__*/_jsx(\"option\", {\n                value: item._id,\n                children: item.name\n              }, item._id);\n            })]\n          })\n        }), /*#__PURE__*/_jsx(\"button\", {\n          type: \"submit\",\n          className: \"btn btn-info my-2 px-4\",\n          children: onEdit ? 'Update' : 'Create'\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-md-6 my-4\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"input-group mb-3\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"input-group-prepend\",\n            children: /*#__PURE__*/_jsx(\"span\", {\n              className: \"input-group-text\",\n              children: \"Upload\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"custom-file border rounded\",\n            children: /*#__PURE__*/_jsx(\"input\", {\n              type: \"file\",\n              className: \"custom-file-input\",\n              onChange: handleUploadInput,\n              multiple: true,\n              accept: \"image/*\"\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"row img-up mx-0\",\n          children: images.map(function (img, index) {\n            return /*#__PURE__*/_jsxs(\"div\", {\n              className: \"file_img my-1\",\n              children: [/*#__PURE__*/_jsx(\"img\", {\n                src: img.url ? img.url : URL.createObjectURL(img),\n                alt: \"\",\n                className: \"img-thumbnail rounded\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                onClick: function onClick() {\n                  return deleteImage(index);\n                },\n                children: \"X\"\n              })]\n            }, index);\n          })\n        })]\n      })]\n    })]\n  });\n};\n\nexport default ProductsManager;","map":null,"metadata":{},"sourceType":"module"}